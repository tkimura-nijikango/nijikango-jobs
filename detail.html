<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>æ±‚äººè©³ç´° - ãƒ‹ã‚¸çœ‹è­·</title>
    <link rel="icon" type="image/png" href="./logo.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f88caa',
                        'primary-hover': '#e07b99',
                        'primary-light': '#fff0f4',
                        'primary-dark': '#d16a88',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'Hiragino Sans', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes bounce-loader { 0%,100%{transform:scale(0)} 50%{transform:scale(1)} }
        .animate-bounce-loader { animation: bounce-loader 1s infinite ease-in-out; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>

<body class="bg-gray-50 font-sans pb-24">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white/95 flex flex-col justify-center items-center z-[9999]">
        <div class="w-16 h-16 bg-primary rounded-full animate-bounce-loader relative">
            <span class="absolute top-4 left-3 w-3 h-3 bg-white rounded-full"></span>
            <span class="absolute top-4 right-3 w-3 h-3 bg-white rounded-full"></span>
        </div>
        <div class="mt-5 text-primary font-bold text-lg">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <!-- Modal -->
    <div id="customModal" class="fixed inset-0 bg-black/50 hidden justify-center items-center z-[10000]">
        <div class="bg-white p-8 rounded-2xl text-center w-[90%] max-w-[400px] shadow-2xl">
            <div id="modalText" class="text-gray-800 text-lg leading-relaxed mb-6 whitespace-pre-wrap"></div>
            <div id="modalButtons" class="flex justify-center gap-4"></div>
        </div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-[1000] bg-white shadow-sm">
        <div class="max-w-3xl mx-auto flex justify-between items-center px-4 h-14">
            <a href="javascript:void(0)" onclick="closeTabOrBack()"
                class="no-underline text-gray-600 font-medium flex items-center gap-1 text-sm hover:text-gray-800 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                <span>æˆ»ã‚‹</span>
            </a>
            <div class="flex items-center gap-2">
                <img src="logo.jpg" alt="ãƒ‹ã‚¸çœ‹è­·" class="h-7 w-auto rounded">
                <span class="text-base font-bold text-primary">æ±‚äººè©³ç´°</span>
            </div>
            <div class="w-[50px]"></div>
        </div>
    </header>

    <!-- Content -->
    <div id="content" class="max-w-3xl mx-auto p-4"></div>

    <!-- Action Bar -->
    <div class="fixed bottom-0 left-0 w-full bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.08)] z-[1000]" id="actionBar" style="display:none;">
        <div class="max-w-3xl mx-auto px-4 py-3 flex gap-3">
            <button id="addCartBtn"
                class="flex-shrink-0 w-14 h-12 bg-white text-primary border-2 border-primary font-bold rounded-xl text-sm cursor-pointer flex items-center justify-center transition-all active:scale-[0.95]">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            </button>
            <button id="applyBtn"
                class="flex-1 bg-primary text-white font-bold border-none h-12 rounded-xl text-base cursor-pointer flex items-center justify-center shadow-[0_4px_12px_rgba(248,140,170,0.35)] transition-all active:scale-[0.98]">
                ã“ã®æ±‚äººã«å¿œå‹Ÿã™ã‚‹
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        const DATA_URL = './jobs.zip';
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwgGfNXsduo1lZWAAbwJz-xdrAsXp3zTeiOx-KIrvtC4AK_09q7nV-ZYYRxoeIbXBrzqw/exec';
        const WORKER_API_URL = 'https://nijikango-jobs-api.t-kimura-business.workers.dev';

        function mapD1ToDisplay(j){return{
            'æ±‚äººç•ªå·':j.job_number||'','æ±‚äººID':j.job_id||'','æ±‚äººã‚¿ã‚¤ãƒˆãƒ«':j.title||'','æ–½è¨­å':'éå…¬é–‹',
            'å¹´å':j.salary||'','æœˆçµ¦':j.monthly_salary||'','æ™‚çµ¦':j.hourly_salary||'','çµ¦ä¸å‚™è€ƒ':j.salary_note||'',
            'å„ç¨®æ‰‹å½“':j.allowance||'','è·ç¨®':j.job_type||'','é›‡ç”¨å½¢æ…‹':j.employment_type||'','æ–½è¨­å½¢æ…‹':j.facility_type||'',
            'å‹¤å‹™å½¢æ…‹':j.work_style||'','å‹¤å‹™æ™‚é–“':j.work_hours||'','ä¼‘æ—¥':j.holiday||'','æ‹…å½“æ¥­å‹™':j.duties||'',
            'æ¥­å‹™å†…å®¹':j.description||'','çµŒé¨“ãƒ»ã‚¹ã‚­ãƒ«':j.requirements||'','éƒ½é“åºœçœŒ':j.prefecture||'','å¸‚åŒºç”ºæ‘':j.city||'',
            'å‹¤å‹™åœ°':j.location||'','æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰':j.station||'','é€šå‹¤äº¤é€šè²»':j.commute||'','æ³•äººå':'éå…¬é–‹',
            'è¨ºç™‚ç§‘ç›®':j.medical_dept||'','ç¦åˆ©åšç”Ÿ':j.benefits||'','ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰':j.tags||'','ç‰¹å¾´ã‚¿ã‚°':j.tags||'',
            'POINT1':j.point1||'','POINT2':j.point2||'','POINT3':j.point3||'','å–æNOTE':j.interview_note||'',
            'ãŠã™ã™ã‚æ±‚äºº':j.recommend_flag?'true':'false','å¹´åä¸‹é™':j.min_salary||0,'å¹´åä¸Šé™':j.max_salary||0,
            'è·ç¨®å¤§æ ':j.category||'','è·ç¨®è©³ç´°':j.detail||'','æ›´æ–°æ—¥':j.updated_at||''
        };}

        const params = new URLSearchParams(window.location.search);
        const jobId = params.get('id');
        const uid = params.get('uid') || '';

        let currentJob = null;
        const cart = new Set(JSON.parse(localStorage.getItem('nijikango_cart') || '[]').map(String));

        window.addEventListener('DOMContentLoaded', async () => {
            if (!jobId) { showError('æ±‚äººIDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'); return; }

            try {
                let job = null;

                // Strategy 1: localStorage cache
                const cached = getCachedJobs();
                if (cached) {
                    job = cached.find(j => String(j['æ±‚äººç•ªå·'] || j['æ±‚äººID']) === String(jobId));
                    if (job) console.log('Loaded from cache');
                }

                // Strategy 2: Worker API
                if (!job) {
                    try {
                        const res = await fetch(`${WORKER_API_URL}/api/jobs/${encodeURIComponent(jobId)}`);
                        if (res.ok) {
                            const json = await res.json();
                            if (json.job) { job = mapD1ToDisplay(json.job); console.log('Loaded from Worker API'); }
                        }
                    } catch (e) { console.warn('Worker API unavailable:', e.message); }
                }

                // Strategy 3: jobs.zip fallback
                if (!job) {
                    const res = await fetch(`${DATA_URL}?t=${Date.now()}`);
                    if (!res.ok) throw new Error('Failed to load');
                    const blob = await res.blob();
                    const zip = await JSZip.loadAsync(blob);
                    const fn = Object.keys(zip.files).find(n => n.endsWith('.json'));
                    if (!fn) throw new Error('No JSON');
                    const txt = await zip.files[fn].async('string');
                    const data = JSON.parse(txt);
                    job = data.find(j => String(j['æ±‚äººç•ªå·'] || j['æ±‚äººID']) === String(jobId));
                    if (job) console.log('Loaded from zip');
                }

                if (job) { currentJob = job; renderJob(job); }
                else { showError('è©²å½“ã™ã‚‹æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚'); }
            } catch (e) {
                console.error(e);
                showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            } finally {
                setTimeout(() => { document.getElementById('loadingOverlay').style.display = 'none'; }, 400);
            }
        });

        function getCachedJobs() {
            try {
                const cache = localStorage.getItem('jobs_cache');
                if (!cache) return null;
                const parsed = JSON.parse(cache);
                if (Date.now() - parsed.timestamp < 3 * 60 * 60 * 1000) return parsed.data;
                return null;
            } catch (e) { return null; }
        }

        function renderJob(job) {
            const title = job['æ±‚äººã‚¿ã‚¤ãƒˆãƒ«'] || 'æ±‚äººè©³ç´°';
            const facility = 'éå…¬é–‹';
            const jobNumber = String(job['æ±‚äººç•ªå·'] || job['æ±‚äººID'] || '');

            const facilityType = job['æ–½è¨­å½¢æ…‹'] || '';
            const empType = job['é›‡ç”¨å½¢æ…‹'] || '';
            const workStyle = job['å‹¤å‹™å½¢æ…‹'] || '';
            const featuresRaw = job['ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰'] || job['ç‰¹å¾´ã‚¿ã‚°'] || '';
            const tags = featuresRaw.split(',').filter(Boolean);

            // Build badges
            const badges = [];
            if (facilityType) badges.push(`<span class="text-xs px-2.5 py-1 rounded-full bg-primary-light text-primary font-medium">${esc(facilityType)}</span>`);
            if (empType) badges.push(`<span class="text-xs px-2.5 py-1 rounded-full bg-blue-50 text-blue-600 font-medium">${esc(empType)}</span>`);
            if (workStyle) badges.push(`<span class="text-xs px-2.5 py-1 rounded-full bg-gray-100 text-gray-600">${esc(workStyle)}</span>`);
            const featureTags = tags.map(t => `<span class="text-xs px-2 py-0.5 rounded bg-gray-50 text-gray-500 border border-gray-100">${esc(t)}</span>`).join('');

            // Points
            const points = [job['POINT1'], job['POINT2'], job['POINT3']].filter(Boolean);
            const pointsHtml = points.length > 0 ? `
                <div class="bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl p-4 border border-pink-100 mb-3">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="w-1 h-5 bg-primary rounded-full inline-block"></span>
                        <h2 class="text-sm font-bold text-primary">ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ</h2>
                    </div>
                    <ul class="space-y-2.5">
                        ${points.map((p, i) => `<li class="flex items-start gap-2.5 text-sm text-gray-700"><span class="flex-shrink-0 w-5 h-5 bg-primary text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5">${i + 1}</span><span class="leading-relaxed">${esc(p)}</span></li>`).join('')}
                    </ul>
                </div>` : '';

            // Interview note
            const note = job['å–æNOTE'] || '';
            const noteHtml = note ? `
                <div class="bg-amber-50 rounded-xl p-4 border border-amber-100 mb-3">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="w-1 h-5 bg-amber-400 rounded-full inline-block"></span>
                        <h2 class="text-sm font-bold text-amber-700">å–æãƒ¡ãƒ¢</h2>
                    </div>
                    <p class="text-sm text-gray-700 leading-relaxed whitespace-pre-wrap">${esc(note)}</p>
                </div>` : '';

            // Detail table - grouped sections
            const salaryFields = [
                { label: 'å¹´å', value: job['å¹´å'] || '', highlight: true },
                { label: 'æœˆçµ¦', value: job['æœˆçµ¦'] || '' },
                { label: 'æ™‚çµ¦', value: job['æ™‚çµ¦'] || '' },
                { label: 'çµ¦ä¸å‚™è€ƒ', value: job['çµ¦ä¸å‚™è€ƒ'] || '' },
                { label: 'å„ç¨®æ‰‹å½“', value: job['å„ç¨®æ‰‹å½“'] || '' },
            ].filter(f => f.value && String(f.value).trim() && f.value !== '-');

            const workFields = [
                { label: 'æ–½è¨­å½¢æ…‹', value: facilityType },
                { label: 'è·ç¨®', value: job['è·ç¨®'] || '' },
                { label: 'é›‡ç”¨å½¢æ…‹', value: empType },
                { label: 'å‹¤å‹™å½¢æ…‹', value: workStyle },
                { label: 'æ¥­å‹™å†…å®¹', value: job['æ¥­å‹™å†…å®¹'] || job['æ‹…å½“æ¥­å‹™'] || '' },
                { label: 'çµŒé¨“ãƒ»ã‚¹ã‚­ãƒ«', value: job['çµŒé¨“ãƒ»ã‚¹ã‚­ãƒ«'] || '' },
                { label: 'å‹¤å‹™æ™‚é–“', value: job['å‹¤å‹™æ™‚é–“'] || '' },
                { label: 'ä¼‘æ—¥', value: job['ä¼‘æ—¥'] || '' },
                { label: 'è¨ºç™‚ç§‘ç›®', value: job['è¨ºç™‚ç§‘ç›®'] || '' },
            ].filter(f => f.value && String(f.value).trim() && f.value !== '-');

            const locationFields = [
                { label: 'å‹¤å‹™åœ°', value: buildLocation(job) },
                { label: 'æœ€å¯„é§…', value: job['æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰'] || '' },
                { label: 'é€šå‹¤äº¤é€šè²»', value: job['é€šå‹¤äº¤é€šè²»'] || '' },
            ].filter(f => f.value && String(f.value).trim() && f.value !== '-');

            const otherFields = [
                { label: 'ç¦åˆ©åšç”Ÿ', value: job['ç¦åˆ©åšç”Ÿ'] || '' },
            ].filter(f => f.value && String(f.value).trim() && f.value !== '-');

            function buildTable(fields) {
                return fields.map(f => `
                    <tr>
                        <th class="text-left py-3 px-0 border-b border-gray-100 align-top w-[25%] text-gray-500 font-medium text-xs">${f.label}</th>
                        <td class="text-left py-3 pl-3 border-b border-gray-100 align-top leading-relaxed whitespace-pre-wrap text-sm ${f.highlight ? 'text-primary font-bold' : 'text-gray-800'}">${esc(String(f.value))}</td>
                    </tr>`).join('');
            }

            function buildSection(icon, title, fields) {
                if (!fields.length) return '';
                return `
                <div class="bg-white rounded-xl shadow-sm mb-3 overflow-hidden">
                    <div class="px-4 pt-4 pb-2 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>
                        <h2 class="text-sm font-bold text-gray-700">${icon} ${title}</h2>
                    </div>
                    <div class="px-4 pb-4">
                        <table class="w-full border-collapse">${buildTable(fields)}</table>
                    </div>
                </div>`;
            }

            const html = `
                <!-- Main Info Card -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-3">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-gray-400 text-xs font-medium">No.${esc(jobNumber)}</span>
                        ${job['æ›´æ–°æ—¥'] ? `<span class="text-xs text-gray-400">${esc(job['æ›´æ–°æ—¥'])}</span>` : ''}
                    </div>
                    <div class="flex flex-wrap gap-1.5 mb-3">${badges.join('')}</div>
                    <h1 class="text-lg font-bold text-gray-800 leading-snug mb-4">${esc(title)}</h1>

                    <!-- Salary Highlight -->
                    ${job['å¹´å'] ? `
                    <div class="bg-primary-light rounded-xl p-3.5 mb-4 flex items-center gap-3">
                        <span class="text-xl">ğŸ’°</span>
                        <div>
                            <div class="text-xs text-gray-500 font-medium mb-0.5">å¹´å</div>
                            <div class="text-primary font-bold text-lg">${esc(job['å¹´å'])}</div>
                        </div>
                    </div>` : ''}

                    <!-- Location Summary -->
                    ${buildLocation(job) ? `
                    <div class="flex items-start gap-2 text-sm text-gray-600 mb-2">
                        <svg class="w-4 h-4 mt-0.5 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        <span>${esc(buildLocation(job))}</span>
                    </div>` : ''}
                    ${job['æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰'] ? `
                    <div class="flex items-start gap-2 text-sm text-gray-500 mb-3">
                        <svg class="w-4 h-4 mt-0.5 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                        <span>${esc(job['æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰'])}</span>
                    </div>` : ''}

                    <!-- Feature Tags -->
                    ${featureTags ? `<div class="flex flex-wrap gap-1.5">${featureTags}</div>` : ''}
                </div>

                ${pointsHtml}
                ${noteHtml}

                ${buildSection('ğŸ’°', 'çµ¦ä¸ãƒ»å¾…é‡', salaryFields)}
                ${buildSection('ğŸ¥', 'ä»•äº‹å†…å®¹', workFields)}
                ${buildSection('ğŸ“', 'ã‚¢ã‚¯ã‚»ã‚¹', locationFields)}
                ${buildSection('ğŸ', 'ç¦åˆ©åšç”Ÿ', otherFields)}

                <div style="height:20px;"></div>
            `;

            document.getElementById('content').innerHTML = html;

            // Cart button
            const cartBtn = document.getElementById('addCartBtn');
            updateCartBtn(cartBtn, jobNumber);
            cartBtn.onclick = () => {
                if (cart.has(jobNumber)) { cart.delete(jobNumber); }
                else { cart.add(jobNumber); }
                localStorage.setItem('nijikango_cart', JSON.stringify(Array.from(cart)));
                updateCartBtn(cartBtn, jobNumber);
            };

            // Apply button
            const applyBtn = document.getElementById('applyBtn');
            applyBtn.onclick = async (e) => {
                e.preventDefault();
                if (applyBtn.classList.contains('disabled')) return;

                showModal('å¿œå‹Ÿå‡¦ç†ä¸­ã§ã™...');
                await new Promise(r => setTimeout(r, 600));
                showModal('å¿œå‹ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nLINEã«æ­£å¼ãªæ¡ˆå†…ã‚’ãŠé€ã‚Šã™ã‚‹ã®ã§ã€\nãƒˆãƒ¼ã‚¯ç”»é¢ã«æˆ»ã£ã¦ãŠå¾…ã¡ãã ã•ã„', true);

                applyBtn.textContent = 'å¿œå‹Ÿæ¸ˆã¿';
                applyBtn.classList.add('disabled');
                applyBtn.style.backgroundColor = '#ccc';
                applyBtn.style.pointerEvents = 'none';
                applyBtn.style.boxShadow = 'none';

                if (uid) {
                    try {
                        fetch(GAS_API_URL, {
                            method: 'POST', mode: 'no-cors',
                            headers: { 'Content-Type': 'text/plain' },
                            body: JSON.stringify({ action: 'apply', userId: uid, jobId: jobNumber })
                        }).catch(err => console.error('Apply error:', err));
                    } catch (err) { console.error('Apply error:', err); }
                }
            };

            document.getElementById('actionBar').style.display = 'block';
            document.title = `${title} - ãƒ‹ã‚¸çœ‹è­·`;
        }

        function buildLocation(job) {
            const parts = [job['éƒ½é“åºœçœŒ'] || '', job['å¸‚åŒºç”ºæ‘'] || '', job['å‹¤å‹™åœ°'] || ''].filter(Boolean);
            if (parts.length > 1) {
                const loc = parts[parts.length - 1];
                return parts.filter((p, i) => i === parts.length - 1 || !loc.includes(p)).join(' ') || loc;
            }
            return parts.join(' ') || '';
        }

        function updateCartBtn(btn, jobNumber) {
            const heartSvg = btn.querySelector('svg');
            if (cart.has(jobNumber)) {
                btn.classList.remove('bg-white', 'border-primary', 'text-primary');
                btn.classList.add('bg-primary-light', 'border-primary', 'text-primary');
                if (heartSvg) heartSvg.setAttribute('fill', 'currentColor');
            } else {
                btn.classList.remove('bg-primary-light');
                btn.classList.add('bg-white', 'border-primary', 'text-primary');
                if (heartSvg) heartSvg.setAttribute('fill', 'none');
            }
        }

        function showModal(text, hasCloseBtn = false) {
            const modal = document.getElementById('customModal');
            const msg = document.getElementById('modalText');
            const btns = document.getElementById('modalButtons');
            msg.textContent = text;
            btns.innerHTML = '';
            if (hasCloseBtn) {
                const btn = document.createElement('button');
                btn.className = 'bg-primary text-white border-none py-3 px-6 rounded-xl text-base font-bold cursor-pointer transition-opacity active:opacity-80 min-w-[120px]';
                btn.textContent = 'é–‰ã˜ã‚‹';
                btn.onclick = () => { modal.style.display = 'none'; modal.classList.add('hidden'); closeTabOrBack(); };
                btns.appendChild(btn);
            }
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function showError(msg) {
            document.getElementById('content').innerHTML = `<div class="text-center py-16 text-gray-400 bg-white rounded-xl mt-4"><p>${msg}</p><a href="index.html${uid ? '?uid=' + encodeURIComponent(uid) : ''}" class="inline-block mt-3 text-primary text-sm font-medium hover:underline">â† æ±‚äººä¸€è¦§ã«æˆ»ã‚‹</a></div>`;
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function esc(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function closeTabOrBack() {
            if (window.history.length > 1 && document.referrer && document.referrer.includes(location.hostname)) {
                window.history.back(); return;
            }
            let target = 'index.html';
            if (uid) target += `?uid=${encodeURIComponent(uid)}`;
            window.location.href = target;
        }
    </script>
</body>

</html>
