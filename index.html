<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>æ±‚äººæ¤œç´¢ - ãƒ‹ã‚¸çœ‹è­·</title>
    <link rel="icon" type="image/png" href="./logo.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f88caa',
                        'primary-hover': '#e07b99',
                        'primary-light': '#fff0f4',
                        'primary-dark': '#d16a88',
                        accent: '#f88caa',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'Hiragino Sans', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes bounce-loader { 0%,100%{transform:scale(0)} 50%{transform:scale(1)} }
        .animate-bounce-loader { animation: bounce-loader 1s infinite ease-in-out; }
        @keyframes fade-in-up { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
        .animate-fade-in-up { animation: fade-in-up 0.25s ease forwards; }
        @keyframes slide-up { from{transform:translateX(-50%) translateY(100px)} to{transform:translateX(-50%) translateY(0)} }
        .cart-bar-enter { animation: slide-up 0.3s cubic-bezier(0.175,0.885,0.32,1.275) forwards; }
        @keyframes heart-pop { 0%{transform:scale(1)} 50%{transform:scale(1.3)} 100%{transform:scale(1)} }
        .heart-pop { animation: heart-pop 0.3s ease; }
        .hide-scrollbar::-webkit-scrollbar { display:none; }
        .hide-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
        .filter-section { max-height:0; overflow:hidden; transition:max-height 0.3s ease; }
        .filter-section.open { max-height:600px; }
        .chip { transition: all 0.15s ease; }
        .chip-active { background-color:#f88caa!important; color:white!important; border-color:#f88caa!important; }
        .filter-btn.active { background-color:#fff0f4; color:#f88caa; border-color:#f88caa; }
        .filter-btn.active .filter-count { display:inline-flex; }
        .filter-count { display:none; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>

<body class="bg-gray-50 font-sans text-gray-800 min-h-screen">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white/95 flex flex-col items-center justify-center z-[9999]">
        <div class="w-16 h-16 bg-primary rounded-full animate-bounce-loader relative">
            <span class="absolute top-4 left-3 w-3 h-3 bg-white rounded-full"></span>
            <span class="absolute top-4 right-3 w-3 h-3 bg-white rounded-full"></span>
        </div>
        <div class="mt-5 text-primary font-bold text-lg">æ±‚äººã‚’æ¢ã—ã¦ã„ã¾ã™...</div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white shadow-sm">
        <div class="max-w-3xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <img src="logo.jpg" alt="ãƒ‹ã‚¸çœ‹è­·" class="h-8 w-auto rounded">
                <span class="text-lg font-bold text-primary tracking-tight">ãƒ‹ã‚¸çœ‹è­·</span>
            </div>
            <span class="text-xs text-gray-400 font-medium">çœ‹è­·å¸«æ±‚äººæ¤œç´¢</span>
        </div>
    </header>

    <!-- Search Bar -->
    <div class="bg-gradient-to-b from-primary to-pink-400">
        <div class="max-w-3xl mx-auto px-4 py-5">
            <p class="text-white text-sm font-medium mb-3 opacity-90">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ±‚äººã‚’æ¤œç´¢</p>
            <div class="flex gap-2">
                <div class="flex-1 relative">
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    <input type="text" id="keywordInput"
                        class="w-full h-12 pl-10 pr-4 rounded-lg border-0 focus:ring-2 focus:ring-pink-300 focus:outline-none text-sm placeholder-gray-400"
                        placeholder="è·ç¨®ã€æ–½è¨­åã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã©">
                </div>
                <button id="searchBtn"
                    class="h-12 px-5 bg-white hover:bg-gray-50 text-primary font-bold rounded-lg transition-colors text-sm flex-shrink-0 shadow-sm active:scale-95">
                    æ¤œç´¢
                </button>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="bg-white border-b border-gray-100 shadow-sm">
        <div class="max-w-3xl mx-auto">
            <!-- Filter Category Buttons -->
            <div class="px-4 py-3 flex gap-2 overflow-x-auto hide-scrollbar">
                <button class="filter-btn flex-shrink-0 text-sm border border-gray-200 rounded-full px-4 py-2 font-medium text-gray-600 bg-white flex items-center gap-1.5 active:scale-95 transition-all" data-target="areaFilter">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    ã‚¨ãƒªã‚¢
                    <span class="filter-count bg-primary text-white text-xs w-5 h-5 rounded-full items-center justify-center font-bold" id="areaCount">0</span>
                </button>
                <button class="filter-btn flex-shrink-0 text-sm border border-gray-200 rounded-full px-4 py-2 font-medium text-gray-600 bg-white flex items-center gap-1.5 active:scale-95 transition-all" data-target="facilityFilter">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    æ–½è¨­å½¢æ…‹
                    <span class="filter-count bg-primary text-white text-xs w-5 h-5 rounded-full items-center justify-center font-bold" id="facilityCount">0</span>
                </button>
                <button class="filter-btn flex-shrink-0 text-sm border border-gray-200 rounded-full px-4 py-2 font-medium text-gray-600 bg-white flex items-center gap-1.5 active:scale-95 transition-all" data-target="employmentFilter">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    é›‡ç”¨å½¢æ…‹
                    <span class="filter-count bg-primary text-white text-xs w-5 h-5 rounded-full items-center justify-center font-bold" id="employmentCount">0</span>
                </button>
                <button class="filter-btn flex-shrink-0 text-sm border border-gray-200 rounded-full px-4 py-2 font-medium text-gray-600 bg-white flex items-center gap-1.5 active:scale-95 transition-all" data-target="salaryFilter">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    å¹´å
                    <span class="filter-count bg-primary text-white text-xs w-5 h-5 rounded-full items-center justify-center font-bold" id="salaryCount">0</span>
                </button>
                <button class="filter-btn flex-shrink-0 text-sm border border-gray-200 rounded-full px-4 py-2 font-medium text-gray-600 bg-white flex items-center gap-1.5 active:scale-95 transition-all" data-target="featureFilter">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    ã“ã ã‚ã‚Š
                    <span class="filter-count bg-primary text-white text-xs w-5 h-5 rounded-full items-center justify-center font-bold" id="featureCount">0</span>
                </button>
            </div>

            <!-- Area Filter Panel -->
            <div id="areaFilter" class="filter-section border-t border-gray-100">
                <div class="px-4 py-4">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>ã‚¨ãƒªã‚¢ã§æ¢ã™
                    </h3>
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="text-xs text-gray-500 font-medium mb-1.5 block">åœ°æ–¹</label>
                            <select id="regionInput" class="w-full text-sm border border-gray-200 rounded-lg px-3 py-2.5 bg-white focus:outline-none focus:ring-2 focus:ring-primary/30 appearance-none" style="background-image:url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23999%27 d=%27M6 8L1 3h10z%27/%3E%3C/svg%3E');background-repeat:no-repeat;background-position:right 12px center;padding-right:36px;">
                                <option value="">ã™ã¹ã¦ã®ã‚¨ãƒªã‚¢</option>
                                <option value="é–¢æ±">é–¢æ±</option>
                                <option value="é–¢è¥¿">é–¢è¥¿</option>
                                <option value="æ±æµ·">æ±æµ·</option>
                                <option value="åŒ—æµ·é“ãƒ»æ±åŒ—">åŒ—æµ·é“ãƒ»æ±åŒ—</option>
                                <option value="ç”²ä¿¡è¶Šãƒ»åŒ—é™¸">ç”²ä¿¡è¶Šãƒ»åŒ—é™¸</option>
                                <option value="ä¸­å›½ãƒ»å››å›½">ä¸­å›½ãƒ»å››å›½</option>
                                <option value="ä¹å·">ä¹å·ãƒ»æ²–ç¸„</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-gray-500 font-medium mb-1.5 block">éƒ½é“åºœçœŒ</label>
                            <select id="prefSelect" class="w-full text-sm border border-gray-200 rounded-lg px-3 py-2.5 bg-white focus:outline-none focus:ring-2 focus:ring-primary/30 appearance-none" style="background-image:url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23999%27 d=%27M6 8L1 3h10z%27/%3E%3C/svg%3E');background-repeat:no-repeat;background-position:right 12px center;padding-right:36px;" disabled>
                                <option value="">å…ˆã«ã‚¨ãƒªã‚¢ã‚’é¸æŠ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Facility Type Filter Panel -->
            <div id="facilityFilter" class="filter-section border-t border-gray-100">
                <div class="px-4 py-4">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>æ–½è¨­å½¢æ…‹
                    </h3>
                    <div class="flex flex-wrap gap-2" id="facilityChips">
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="ç—…é™¢" class="hidden"> ç—…é™¢</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="ã‚¯ãƒªãƒ‹ãƒƒã‚¯" class="hidden"> ã‚¯ãƒªãƒ‹ãƒƒã‚¯</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="è¨ªå•çœ‹è­·" class="hidden"> è¨ªå•çœ‹è­·</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="ä»‹è­·æ–½è¨­" class="hidden"> ä»‹è­·æ–½è¨­</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="ç¾å®¹ã‚¯ãƒªãƒ‹ãƒƒã‚¯" class="hidden"> ç¾å®¹ã‚¯ãƒªãƒ‹ãƒƒã‚¯</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="å¥è¨ºã‚»ãƒ³ã‚¿ãƒ¼" class="hidden"> å¥è¨ºã‚»ãƒ³ã‚¿ãƒ¼</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="facility" value="ä¿è‚²åœ’" class="hidden"> ä¿è‚²åœ’ãƒ»å­¦æ ¡</label>
                    </div>
                </div>
            </div>

            <!-- Employment Type Filter Panel -->
            <div id="employmentFilter" class="filter-section border-t border-gray-100">
                <div class="px-4 py-4">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>é›‡ç”¨å½¢æ…‹
                    </h3>
                    <div class="flex flex-wrap gap-2" id="employmentChips">
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="employment" value="å¸¸å‹¤" class="hidden"> å¸¸å‹¤ï¼ˆæ­£ç¤¾å“¡ï¼‰</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="employment" value="éå¸¸å‹¤" class="hidden"> éå¸¸å‹¤ãƒ»ãƒ‘ãƒ¼ãƒˆ</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="employment" value="æ´¾é£" class="hidden"> æ´¾é£</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="employment" value="å¤œå‹¤å°‚å¾“" class="hidden"> å¤œå‹¤å°‚å¾“</label>
                    </div>
                </div>
            </div>

            <!-- Salary Filter Panel -->
            <div id="salaryFilter" class="filter-section border-t border-gray-100">
                <div class="px-4 py-4">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>å¸Œæœ›å¹´å
                    </h3>
                    <select id="salaryInput" class="w-full text-sm border border-gray-200 rounded-lg px-3 py-2.5 bg-white focus:outline-none focus:ring-2 focus:ring-primary/30 appearance-none" style="background-image:url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23999%27 d=%27M6 8L1 3h10z%27/%3E%3C/svg%3E');background-repeat:no-repeat;background-position:right 12px center;padding-right:36px;">
                        <option value="0">ã“ã ã‚ã‚‰ãªã„</option>
                        <option value="300">300ä¸‡å††ä»¥ä¸Š</option>
                        <option value="400">400ä¸‡å††ä»¥ä¸Š</option>
                        <option value="500">500ä¸‡å††ä»¥ä¸Š</option>
                        <option value="600">600ä¸‡å††ä»¥ä¸Š</option>
                        <option value="700">700ä¸‡å††ä»¥ä¸Š</option>
                    </select>
                </div>
            </div>

            <!-- Feature Filter Panel -->
            <div id="featureFilter" class="filter-section border-t border-gray-100">
                <div class="px-4 py-4">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="w-1 h-4 bg-primary rounded-full inline-block"></span>ã“ã ã‚ã‚Šæ¡ä»¶
                    </h3>
                    <div class="flex flex-wrap gap-2" id="featureChips">
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="æ—¥å‹¤ã®ã¿" class="hidden"> æ—¥å‹¤ã®ã¿</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="å¤œå‹¤å°‚å¾“" class="hidden"> å¤œå‹¤å°‚å¾“</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="åœŸæ—¥ä¼‘ã¿" class="hidden"> åœŸæ—¥ä¼‘ã¿</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="æ®‹æ¥­å°‘ãªã‚" class="hidden"> æ®‹æ¥­å°‘ãªã‚</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="æœªçµŒé¨“å¯" class="hidden"> æœªçµŒé¨“å¯</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="ãƒ–ãƒ©ãƒ³ã‚¯å¯" class="hidden"> ãƒ–ãƒ©ãƒ³ã‚¯å¯</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="å¯®" class="hidden"> å¯®ãƒ»å€Ÿä¸Š</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="è¨—å…æ‰€" class="hidden"> è¨—å…æ‰€ã‚ã‚Š</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="è»Šé€šå‹¤" class="hidden"> è»Šé€šå‹¤å¯</label>
                        <label class="chip inline-flex items-center text-sm border border-gray-200 rounded-full px-3.5 py-2 cursor-pointer hover:border-primary select-none"><input type="checkbox" name="feature" value="é§…è¿‘" class="hidden"> é§…è¿‘</label>
                    </div>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="activeFiltersBar" class="hidden px-4 py-2 border-t border-gray-100 bg-gray-50">
                <div class="flex items-center gap-2 overflow-x-auto hide-scrollbar">
                    <span class="text-xs text-gray-500 flex-shrink-0">çµã‚Šè¾¼ã¿:</span>
                    <div id="activeFilterTags" class="flex gap-1.5"></div>
                    <button id="clearFiltersBtn" class="flex-shrink-0 text-xs text-red-400 font-medium hover:text-red-500 ml-1">ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-4 py-4 pb-28">
        <!-- Result Header -->
        <div class="flex items-center justify-between mb-4">
            <p class="text-sm font-bold text-gray-700" id="resultCount"></p>
            <select id="sortSelect" class="text-xs border border-gray-200 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-primary/30 appearance-none pr-7 font-medium text-gray-600" style="background-image:url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2710%27 height=%2710%27 viewBox=%270 0 10 10%27%3E%3Cpath fill=%27%23999%27 d=%27M5 7L1 3h8z%27/%3E%3C/svg%3E');background-repeat:no-repeat;background-position:right 8px center;">
                <option value="newest">æ–°ç€é †</option>
                <option value="salary_desc">å¹´åãŒé«˜ã„é †</option>
                <option value="salary_asc">å¹´åãŒä½ã„é †</option>
            </select>
        </div>

        <!-- Topics Section -->
        <div id="topicsSection" class="hidden mb-5">
            <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-4 border border-pink-100">
                <div class="flex items-center gap-2 mb-3"><span class="text-base">ğŸ”¥</span><h2 class="text-sm font-bold text-primary">ãŠã™ã™ã‚æ±‚äºº</h2></div>
                <div id="topicsContainer" class="flex gap-3 overflow-x-auto hide-scrollbar pb-1"></div>
            </div>
        </div>

        <!-- Jobs Container -->
        <div id="jobsContainer" class="flex flex-col gap-3"></div>
    </main>

    <!-- Favorites Floating Bar -->
    <div id="cartBar" class="fixed bottom-5 left-1/2 w-[92%] max-w-md bg-primary text-white px-5 py-3.5 rounded-2xl shadow-lg flex justify-between items-center z-[2000]" style="transform:translateX(-50%) translateY(100px);">
        <div class="font-bold text-sm flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            <span>æ°—ã«ãªã‚‹æ±‚äºº</span>
            <span id="cartCount" class="bg-white text-primary px-2 py-0.5 rounded-full text-xs font-bold">0</span>
        </div>
        <button id="applyBtn" class="bg-white text-primary font-bold px-5 py-2 rounded-full shadow hover:bg-gray-50 active:scale-95 transition-all text-sm">ã¾ã¨ã‚ã¦å¿œå‹Ÿ</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const DATA_URL = './jobs.zip';
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwT4dlPuH3edMjF5aWRV_TgAzU0Rz7YS76Zb-H0Dv3G02ph0DR1KY006ldArCJZngFs/exec';
        const WORKER_API_URL = 'https://nijikango-jobs-api.t-kimura-business.workers.dev';
        let allJobs = [], cart = new Set(), currentFilteredJobs = [], currentPage = 1;
        const ITEMS_PER_PAGE = 20;
        const urlParams = new URLSearchParams(window.location.search);
        window.LINE_UID = urlParams.get('uid') || '';

        // Region â†’ Prefecture mapping (with and without suffix for robust matching)
        const REGION_PREF = {
            'é–¢æ±':['æ±äº¬éƒ½','ç¥å¥ˆå·çœŒ','åŸ¼ç‰çœŒ','åƒè‘‰çœŒ','èŒ¨åŸçœŒ','æ ƒæœ¨çœŒ','ç¾¤é¦¬çœŒ'],
            'é–¢è¥¿':['å¤§é˜ªåºœ','å…µåº«çœŒ','äº¬éƒ½åºœ','å¥ˆè‰¯çœŒ','æ»‹è³€çœŒ','å’Œæ­Œå±±çœŒ'],
            'æ±æµ·':['æ„›çŸ¥çœŒ','é™å²¡çœŒ','å²é˜œçœŒ','ä¸‰é‡çœŒ'],
            'ä¹å·':['ç¦å²¡çœŒ','ä½è³€çœŒ','é•·å´çœŒ','ç†Šæœ¬çœŒ','å¤§åˆ†çœŒ','å®®å´çœŒ','é¹¿å…å³¶çœŒ','æ²–ç¸„çœŒ'],
            'åŒ—æµ·é“ãƒ»æ±åŒ—':['åŒ—æµ·é“','é’æ£®çœŒ','å²©æ‰‹çœŒ','å®®åŸçœŒ','ç§‹ç”°çœŒ','å±±å½¢çœŒ','ç¦å³¶çœŒ'],
            'ç”²ä¿¡è¶Šãƒ»åŒ—é™¸':['æ–°æ½ŸçœŒ','å¯Œå±±çœŒ','çŸ³å·çœŒ','ç¦äº•çœŒ','å±±æ¢¨çœŒ','é•·é‡çœŒ'],
            'ä¸­å›½ãƒ»å››å›½':['é³¥å–çœŒ','å³¶æ ¹çœŒ','å²¡å±±çœŒ','åºƒå³¶çœŒ','å±±å£çœŒ','å¾³å³¶çœŒ','é¦™å·çœŒ','æ„›åª›çœŒ','é«˜çŸ¥çœŒ']
        };
        // Short names for fallback matching
        const REGION_PREF_SHORT = {};
        Object.keys(REGION_PREF).forEach(r => {
            REGION_PREF_SHORT[r] = REGION_PREF[r].map(p => p.replace(/[éƒ½åºœçœŒ]$/, ''));
        });

        function truncate(s,n){return s&&s.length>n?s.substring(0,n)+'...':s||'';}
        function escapeHtml(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}

        window.addEventListener('DOMContentLoaded',()=>{
            setupCart();setupFilterPanels();setupFilters();setupChips();setupInteractions();fetchJobs();
        });

        // ========== Filter Panel Toggle ==========
        function setupFilterPanels(){
            document.querySelectorAll('.filter-btn').forEach(btn=>{
                btn.addEventListener('click',()=>{
                    const targetId=btn.dataset.target;
                    const panel=document.getElementById(targetId);
                    const isOpen=panel.classList.contains('open');
                    // Close all panels
                    document.querySelectorAll('.filter-section').forEach(p=>p.classList.remove('open'));
                    document.querySelectorAll('.filter-btn').forEach(b=>{ if(!b.classList.contains('active-filter')) b.style.borderColor=''; });
                    // Toggle this panel
                    if(!isOpen){ panel.classList.add('open'); btn.style.borderColor='#f88caa'; }
                });
            });
        }

        // ========== Chip Toggle ==========
        function setupChips(){
            document.querySelectorAll('.chip').forEach(label=>{
                label.addEventListener('click',()=>{
                    const cb=label.querySelector('input[type="checkbox"]');
                    setTimeout(()=>{
                        cb.checked?label.classList.add('chip-active'):label.classList.remove('chip-active');
                        updateFilterCounts();
                        updateActiveFilters();
                    },0);
                });
            });
        }

        // ========== Filter Counts ==========
        function updateFilterCounts(){
            const region=document.getElementById('regionInput').value;
            const pref=document.getElementById('prefSelect').value;
            const areaC=(region?1:0)+(pref?1:0);
            const facilityC=document.querySelectorAll('input[name="facility"]:checked').length;
            const employmentC=document.querySelectorAll('input[name="employment"]:checked').length;
            const salaryC=parseInt(document.getElementById('salaryInput').value)>0?1:0;
            const featureC=document.querySelectorAll('input[name="feature"]:checked').length;

            updateCountBadge('areaCount',areaC,'areaFilter');
            updateCountBadge('facilityCount',facilityC,'facilityFilter');
            updateCountBadge('employmentCount',employmentC,'employmentFilter');
            updateCountBadge('salaryCount',salaryC,'salaryFilter');
            updateCountBadge('featureCount',featureC,'featureFilter');
        }
        function updateCountBadge(id,count,target){
            const el=document.getElementById(id);
            const btn=document.querySelector(`[data-target="${target}"]`);
            if(count>0){el.textContent=count;el.style.display='inline-flex';btn.classList.add('active');}
            else{el.style.display='none';btn.classList.remove('active');}
        }

        // ========== Active Filters Bar ==========
        function updateActiveFilters(){
            const tags=[];
            const region=document.getElementById('regionInput').value;
            const pref=document.getElementById('prefSelect').value;
            if(pref) tags.push(pref); else if(region) tags.push(region);
            document.querySelectorAll('input[name="facility"]:checked').forEach(c=>tags.push(c.value));
            document.querySelectorAll('input[name="employment"]:checked').forEach(c=>tags.push(c.value));
            const sal=parseInt(document.getElementById('salaryInput').value);
            if(sal>0) tags.push(sal+'ä¸‡å††ä»¥ä¸Š');
            document.querySelectorAll('input[name="feature"]:checked').forEach(c=>tags.push(c.value));

            const bar=document.getElementById('activeFiltersBar');
            const container=document.getElementById('activeFilterTags');
            if(tags.length>0){
                bar.classList.remove('hidden');
                container.innerHTML=tags.map(t=>`<span class="flex-shrink-0 text-xs bg-primary-light text-primary px-2 py-1 rounded-full font-medium">${escapeHtml(t)}</span>`).join('');
            }else{ bar.classList.add('hidden'); }
        }

        // ========== Filters Setup ==========
        function setupFilters(){
            const reg=document.getElementById('regionInput'),pref=document.getElementById('prefSelect');
            reg.addEventListener('change',()=>{
                const r=reg.value;
                pref.innerHTML='<option value="">ã™ã¹ã¦ã®éƒ½é“åºœçœŒ</option>';
                if(r&&REGION_PREF[r]){
                    REGION_PREF[r].forEach(p=>{const o=document.createElement('option');o.value=p;o.textContent=p;pref.appendChild(o);});
                    pref.disabled=false;
                }else{pref.disabled=true;}
                updateFilterCounts();updateActiveFilters();
            });
            pref.addEventListener('change',()=>{updateFilterCounts();updateActiveFilters();});
            document.getElementById('salaryInput').addEventListener('change',()=>{updateFilterCounts();updateActiveFilters();});
            document.getElementById('clearFiltersBtn').addEventListener('click',clearAllFilters);
        }

        function clearAllFilters(){
            document.getElementById('regionInput').value='';
            document.getElementById('prefSelect').innerHTML='<option value="">å…ˆã«ã‚¨ãƒªã‚¢ã‚’é¸æŠ</option>';
            document.getElementById('prefSelect').disabled=true;
            document.getElementById('salaryInput').value='0';
            document.querySelectorAll('.chip input[type="checkbox"]').forEach(c=>{c.checked=false;c.closest('.chip').classList.remove('chip-active');});
            updateFilterCounts();updateActiveFilters();
            currentPage=1;filterAndRender();
        }

        function setupInteractions(){
            document.getElementById('searchBtn').addEventListener('click',()=>{currentPage=1;filterAndRender();});
            document.getElementById('sortSelect').addEventListener('change',()=>{currentPage=1;filterAndRender();});
            document.getElementById('keywordInput').addEventListener('keydown',e=>{if(e.key==='Enter'){currentPage=1;filterAndRender();}});
        }

        // ========== Cart ==========
        function setupCart(){
            const saved=localStorage.getItem('nijikango_cart');
            if(saved){try{JSON.parse(saved).forEach(id=>cart.add(String(id)));updateCartUI();}catch(e){}}
            document.getElementById('applyBtn').addEventListener('click',applyBatch);
        }
        function toggleCart(id,btn){
            id=String(id);const icon=btn.querySelector('.heart-icon');
            if(cart.has(id)){cart.delete(id);btn.classList.remove('text-red-500');btn.classList.add('text-gray-300');if(icon)icon.setAttribute('fill','none');}
            else{cart.add(id);btn.classList.add('text-red-500');btn.classList.remove('text-gray-300');if(icon)icon.setAttribute('fill','currentColor');btn.classList.add('heart-pop');setTimeout(()=>btn.classList.remove('heart-pop'),300);}
            saveCart();updateCartUI();
        }
        function saveCart(){localStorage.setItem('nijikango_cart',JSON.stringify(Array.from(cart)));}
        function updateCartUI(){
            const c=cart.size;document.getElementById('cartCount').textContent=c;const bar=document.getElementById('cartBar');
            if(c>0){bar.style.transform='translateX(-50%) translateY(0)';bar.classList.add('cart-bar-enter');}
            else{bar.style.transform='translateX(-50%) translateY(100px)';bar.classList.remove('cart-bar-enter');}
        }

        // ========== Modals ==========
        function showApplyModal(){
            const c=cart.size;if(!c)return;
            const o=document.createElement('div');o.id='applyModal';o.className='fixed inset-0 bg-black/50 flex items-center justify-center z-[10000]';
            o.innerHTML=`<div class="bg-white p-8 rounded-2xl text-center w-[90%] max-w-md shadow-2xl"><div class="text-gray-800 text-lg leading-relaxed mb-6">${c}ä»¶ã®æ±‚äººã«ã¾ã¨ã‚ã¦å¿œå‹Ÿã—ã¾ã™ã‹ï¼Ÿ</div><div class="flex justify-center gap-4"><button onclick="this.closest('#applyModal').remove()" class="px-6 py-3 rounded-full font-bold bg-gray-100 text-gray-600 min-w-[100px]">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button onclick="this.closest('#applyModal').remove();executeApplyBatch();" class="px-6 py-3 rounded-full font-bold bg-primary text-white min-w-[100px]">å¿œå‹Ÿã™ã‚‹</button></div></div>`;
            document.body.appendChild(o);
        }
        function showResultModal(t){
            const e=document.getElementById('resultModal');if(e)e.remove();
            const o=document.createElement('div');o.id='resultModal';o.className='fixed inset-0 bg-black/50 flex items-center justify-center z-[10000]';
            o.innerHTML=`<div class="bg-white p-8 rounded-2xl text-center w-[90%] max-w-md shadow-2xl"><div class="text-gray-800 text-lg leading-relaxed mb-6 whitespace-pre-wrap">${t}</div><button onclick="this.closest('#resultModal').remove()" class="px-6 py-3 rounded-full font-bold bg-primary text-white min-w-[100px]">é–‰ã˜ã‚‹</button></div>`;
            document.body.appendChild(o);
        }
        async function executeApplyBatch(){
            showResultModal('å¿œå‹ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nLINEã«æ­£å¼ãªæ¡ˆå†…ã‚’ãŠé€ã‚Šã™ã‚‹ã®ã§ã€\nãƒˆãƒ¼ã‚¯ç”»é¢ã«æˆ»ã£ã¦ãŠå¾…ã¡ãã ã•ã„');
            const ids=Array.from(cart);cart.clear();saveCart();updateCartUI();
            document.querySelectorAll('.fav-btn').forEach(b=>{b.classList.remove('text-red-500');b.classList.add('text-gray-300');const i=b.querySelector('.heart-icon');if(i)i.setAttribute('fill','none');});
            try{fetch(GAS_API_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'text/plain'},body:JSON.stringify({action:'apply_batch',userId:window.LINE_UID,jobIds:ids})}).catch(e=>console.error(e));}catch(e){}
        }
        async function applyBatch(){if(!cart.size)return;showApplyModal();}

        // ========== D1â†’æ—¥æœ¬èªã‚­ãƒ¼å¤‰æ› ==========
        function mapD1ToDisplay(j){return{
            'æ±‚äººç•ªå·':j.job_number||'','æ±‚äººID':j.job_id||'','æ±‚äººã‚¿ã‚¤ãƒˆãƒ«':j.title||'','æ–½è¨­å':'éå…¬é–‹',
            'å¹´å':j.salary||'','æœˆçµ¦':j.monthly_salary||'','æ™‚çµ¦':j.hourly_salary||'','çµ¦ä¸å‚™è€ƒ':j.salary_note||'',
            'å„ç¨®æ‰‹å½“':j.allowance||'','è·ç¨®':j.job_type||'','é›‡ç”¨å½¢æ…‹':j.employment_type||'','æ–½è¨­å½¢æ…‹':j.facility_type||'',
            'å‹¤å‹™å½¢æ…‹':j.work_style||'','å‹¤å‹™æ™‚é–“':j.work_hours||'','ä¼‘æ—¥':j.holiday||'','æ‹…å½“æ¥­å‹™':j.duties||'',
            'æ¥­å‹™å†…å®¹':j.description||'','çµŒé¨“ãƒ»ã‚¹ã‚­ãƒ«':j.requirements||'','éƒ½é“åºœçœŒ':j.prefecture||'','å¸‚åŒºç”ºæ‘':j.city||'',
            'å‹¤å‹™åœ°':j.location||'','æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰':j.station||'','é€šå‹¤äº¤é€šè²»':j.commute||'','æ³•äººå':'éå…¬é–‹',
            'è¨ºç™‚ç§‘ç›®':j.medical_dept||'','ç¦åˆ©åšç”Ÿ':j.benefits||'','ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰':j.tags||'','ç‰¹å¾´ã‚¿ã‚°':j.tags||'',
            'POINT1':j.point1||'','POINT2':j.point2||'','POINT3':j.point3||'','å–æNOTE':j.interview_note||'',
            'ãŠã™ã™ã‚æ±‚äºº':j.recommend_flag?'true':'false','å¹´åä¸‹é™':j.min_salary||0,'å¹´åä¸Šé™':j.max_salary||0,
            'è·ç¨®å¤§æ ':j.category||'','è·ç¨®è©³ç´°':j.detail||'','æ›´æ–°æ—¥':j.updated_at||''
        };}

        // ========== Fetch Jobs ==========
        async function fetchJobs(){
            try{
                try{
                    const res=await fetch(`${WORKER_API_URL}/api/jobs?limit=5000&t=${Date.now()}`);
                    if(res.ok){
                        const json=await res.json();
                        if(json.jobs&&json.jobs.length>0){
                            const data=json.jobs.map(mapD1ToDisplay);
                            allJobs=data;console.log(`Loaded ${data.length} jobs from Worker API`);
                            try{localStorage.setItem('jobs_cache',JSON.stringify({timestamp:Date.now(),data}));}catch(e){}
                            renderTopics(data);filterAndRender();return;
                        }
                    }
                }catch(e){console.warn('Worker API unavailable:',e.message);}
                const res=await fetch(`${DATA_URL}?t=${Date.now()}`);if(!res.ok)throw new Error('Not found');
                const blob=await res.blob();const zip=await JSZip.loadAsync(blob);
                const fn=Object.keys(zip.files).find(n=>n.endsWith('.json'));if(!fn)throw new Error('No JSON');
                const txt=await zip.files[fn].async('string');const data=JSON.parse(txt);
                if(Array.isArray(data)&&data.length>0){allJobs=data;try{localStorage.setItem('jobs_cache',JSON.stringify({timestamp:Date.now(),data}));}catch(e){}renderTopics(data);filterAndRender();}
                else{document.getElementById('jobsContainer').innerHTML='<div class="text-center py-12 text-gray-400 bg-white rounded-xl">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';}
            }catch(e){console.error(e);document.getElementById('jobsContainer').innerHTML='<div class="text-center py-12 text-red-400 bg-white rounded-xl">æ±‚äººãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';}
            finally{setTimeout(()=>{document.getElementById('loadingOverlay').style.display='none';},500);}
        }

        // ========== Topics ==========
        function renderTopics(jobs){
            let rec=jobs.filter(j=>{const f=String(j['ãŠã™ã™ã‚æ±‚äºº']||'').toLowerCase();return f==='true'||f==='1';});
            if(rec.length<3){const hi=jobs.filter(j=>parseInt(j['å¹´åä¸‹é™']||0)>=500&&!rec.includes(j));rec=[...rec,...hi];}
            if(rec.length<5){const s=new Set(rec);rec=[...rec,...[...jobs].reverse().filter(j=>!s.has(j))];}
            const final=rec.slice(0,5);if(!final.length)return;
            document.getElementById('topicsSection').classList.remove('hidden');
            document.getElementById('topicsContainer').innerHTML=final.map(j=>{
                const t=j['æ±‚äººã‚¿ã‚¤ãƒˆãƒ«']||'æ³¨ç›®ã®çœ‹è­·æ±‚äºº',s=j['å¹´å']||'å¿œç›¸è«‡',ft=j['æ–½è¨­å½¢æ…‹']||'',id=j['æ±‚äººç•ªå·']||j['æ±‚äººID'];
                return `<a href="detail.html?id=${id}&uid=${window.LINE_UID}" class="flex-shrink-0 w-60 bg-white rounded-xl p-3.5 shadow-sm border border-pink-100 hover:shadow-md transition-shadow no-underline">${ft?`<span class="text-xs bg-primary-light text-primary px-2 py-0.5 rounded font-medium">${escapeHtml(ft)}</span>`:''}<div class="text-sm font-bold text-gray-700 mt-2 leading-snug line-clamp-2">${escapeHtml(truncate(t,28))}</div><div class="text-xs text-primary font-bold mt-2">ğŸ’° ${escapeHtml(s)}</div></a>`;
            }).join('');
        }

        // ========== Filter & Render ==========
        function matchesLocation(loc, target) {
            if (!target) return true;
            // Try exact match first, then without suffix
            if (loc.includes(target)) return true;
            const short = target.replace(/[éƒ½åºœçœŒ]$/, '');
            return loc.includes(short);
        }

        function filterAndRender(){
            const kw=document.getElementById('keywordInput').value.trim().toLowerCase();
            const region=document.getElementById('regionInput').value;
            const pref=document.getElementById('prefSelect').value;
            const minSal=parseInt(document.getElementById('salaryInput').value,10);
            const sort=document.getElementById('sortSelect').value;
            const facilities=Array.from(document.querySelectorAll('input[name="facility"]:checked')).map(c=>c.value);
            const employments=Array.from(document.querySelectorAll('input[name="employment"]:checked')).map(c=>c.value);
            const feats=Array.from(document.querySelectorAll('input[name="feature"]:checked')).map(c=>c.value);

            let filtered=allJobs.filter(j=>{
                const loc=(j['å‹¤å‹™åœ°']||'')+(j['éƒ½é“åºœçœŒ']||'')+(j['å¸‚åŒºç”ºæ‘']||'');
                const jFacility=(j['æ–½è¨­å½¢æ…‹']||j['è·ç¨®å¤§æ ']||'');
                const jSal=parseInt(j['å¹´åä¸‹é™']||0);
                const jFeat=(j['ç‰¹å¾´ã‚¿ã‚°']||'')+(j['ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰']||'');
                const jEmp=(j['é›‡ç”¨å½¢æ…‹']||'');

                // Keyword
                if(kw){const txt=[j['æ±‚äººã‚¿ã‚¤ãƒˆãƒ«'],j['æ–½è¨­å½¢æ…‹'],j['è·ç¨®'],j['æ¥­å‹™å†…å®¹'],j['å‹¤å‹™åœ°'],j['éƒ½é“åºœçœŒ'],j['ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰'],j['ç‰¹å¾´ã‚¿ã‚°'],j['é›‡ç”¨å½¢æ…‹']].join(' ').toLowerCase();if(!txt.includes(kw))return false;}
                // Area (improved matching)
                if(region){
                    if(pref){
                        if(!matchesLocation(loc,pref))return false;
                    }else{
                        const ps=REGION_PREF[region]||[];
                        const psShort=REGION_PREF_SHORT[region]||[];
                        if(!ps.some(p=>loc.includes(p))&&!psShort.some(p=>loc.includes(p)))return false;
                    }
                }
                // Facility type (multiple selection)
                if(facilities.length>0&&!facilities.some(f=>jFacility.includes(f)))return false;
                // Employment type (multiple selection)
                if(employments.length>0&&!employments.some(e=>jEmp.includes(e)))return false;
                // Salary
                if(minSal>0&&jSal<minSal)return false;
                // Features
                if(feats.length>0&&!feats.every(f=>jFeat.includes(f)))return false;
                return true;
            });

            if(sort==='salary_desc')filtered.sort((a,b)=>parseInt(b['å¹´åä¸‹é™']||0)-parseInt(a['å¹´åä¸‹é™']||0));
            else if(sort==='salary_asc')filtered.sort((a,b)=>parseInt(a['å¹´åä¸‹é™']||0)-parseInt(b['å¹´åä¸‹é™']||0));
            currentFilteredJobs=filtered;
            document.getElementById('resultCount').innerHTML=`<span class="text-primary text-lg font-bold">${filtered.length}</span><span class="text-gray-500 text-sm ml-1">ä»¶ã®æ±‚äºº</span>`;
            renderPage();
        }

        // ========== Render Page ==========
        function renderPage(){
            const con=document.getElementById('jobsContainer');
            const tp=Math.ceil(currentFilteredJobs.length/ITEMS_PER_PAGE);
            const start=(currentPage-1)*ITEMS_PER_PAGE;
            const page=currentFilteredJobs.slice(start,start+ITEMS_PER_PAGE);

            if(!page.length){
                con.innerHTML='<div class="text-center py-16 bg-white rounded-xl border border-gray-100"><p class="text-gray-400 text-sm">æ¡ä»¶ã«åˆã†æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p><button onclick="clearAllFilters()" class="mt-3 text-primary text-sm font-medium hover:underline">æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹</button></div>';
                return;
            }

            con.innerHTML=page.map((j,i)=>{
                const id=j['æ±‚äººç•ªå·']||j['æ±‚äººID'];
                const title=j['æ±‚äººã‚¿ã‚¤ãƒˆãƒ«']||'æ±‚äºº';
                const salary=j['å¹´å']||'å¿œç›¸è«‡';
                const monthlySalary=j['æœˆçµ¦']||'';
                const locParts=[(j['éƒ½é“åºœçœŒ']||''),(j['å¸‚åŒºç”ºæ‘']||'')].filter(Boolean);
                const loc=locParts.join(' ')||'';
                const station=j['æœ€å¯„é§…ï¼ˆè·¯ç·šï¼‰']||'';
                const ft=j['æ–½è¨­å½¢æ…‹']||'';
                const emp=j['é›‡ç”¨å½¢æ…‹']||'';
                const workStyle=j['å‹¤å‹™å½¢æ…‹']||'';
                const featsRaw=(j['ç‰¹å¾´ã‚¿ã‚°']||j['ã‚¿ã‚°ï¼ˆç‰¹å¾´ï¼‰']||'').split(',').filter(Boolean).slice(0,4);
                const desc=truncate(j['æ¥­å‹™å†…å®¹']||j['æ‹…å½“æ¥­å‹™']||'',80);
                const inCart=cart.has(String(id));

                // Build tags
                const badges=[];
                if(ft) badges.push(`<span class="text-xs px-2 py-0.5 rounded bg-primary-light text-primary font-medium">${escapeHtml(ft)}</span>`);
                if(emp) badges.push(`<span class="text-xs px-2 py-0.5 rounded bg-blue-50 text-blue-600 font-medium">${escapeHtml(emp)}</span>`);
                if(workStyle) badges.push(`<span class="text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600">${escapeHtml(workStyle)}</span>`);
                const featureTags=featsRaw.map(t=>`<span class="text-xs px-2 py-0.5 rounded bg-gray-50 text-gray-500 border border-gray-100">${escapeHtml(t)}</span>`).join('');

                return `<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden animate-fade-in-up" style="animation-delay:${i*25}ms">
                    <a href="detail.html?id=${id}&uid=${window.LINE_UID}" class="block p-4 no-underline text-inherit">
                        <!-- Badges -->
                        <div class="flex flex-wrap gap-1.5 mb-2.5">${badges.join('')}</div>
                        <!-- Title -->
                        <h3 class="text-[15px] font-bold text-gray-800 leading-snug mb-3">${escapeHtml(title)}</h3>
                        <!-- Salary -->
                        <div class="bg-primary-light rounded-lg px-3 py-2 mb-3 flex items-center gap-2">
                            <span class="text-sm">ğŸ’°</span>
                            <div>
                                <span class="text-primary font-bold text-sm">${escapeHtml(salary)}</span>
                                ${monthlySalary?`<span class="text-xs text-gray-500 ml-1.5">ï¼ˆ${escapeHtml(truncate(monthlySalary,20))}ï¼‰</span>`:''}
                            </div>
                        </div>
                        <!-- Location -->
                        <div class="space-y-1.5 mb-3">
                            ${loc?`<div class="flex items-start gap-2 text-sm text-gray-600"><svg class="w-4 h-4 mt-0.5 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg><span>${escapeHtml(loc)}</span></div>`:''}
                            ${station?`<div class="flex items-start gap-2 text-sm text-gray-500"><svg class="w-4 h-4 mt-0.5 flex-shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>${escapeHtml(truncate(station,30))}</span></div>`:''}
                        </div>
                        <!-- Description -->
                        ${desc?`<p class="text-xs text-gray-500 mb-3 leading-relaxed line-clamp-2">${escapeHtml(desc)}</p>`:''}
                        <!-- Feature tags -->
                        ${featureTags?`<div class="flex flex-wrap gap-1 mb-1">${featureTags}</div>`:''}
                    </a>
                    <!-- Card Footer -->
                    <div class="px-4 py-2.5 flex items-center justify-between border-t border-gray-50 bg-gray-50/50">
                        <button class="fav-btn ${inCart?'text-red-500':'text-gray-300'} hover:scale-110 transition-transform p-1" onclick="event.stopPropagation();toggleCart('${id}',this)">
                            <svg class="w-6 h-6 heart-icon" fill="${inCart?'currentColor':'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                        </button>
                        <a href="detail.html?id=${id}&uid=${window.LINE_UID}" class="text-xs text-primary font-bold flex items-center gap-1 hover:underline">
                            è©³ç´°ã‚’è¦‹ã‚‹
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </a>
                    </div>
                </div>`;
            }).join('');

            // Pagination
            if(tp>1){
                con.innerHTML+=`<div class="flex justify-center items-center gap-3 mt-6 mb-4">
                    <button onclick="changePage(-1)" ${currentPage<=1?'disabled':''} class="px-5 py-2.5 rounded-lg font-bold text-sm ${currentPage<=1?'bg-gray-100 text-gray-400 cursor-not-allowed':'bg-white text-gray-700 shadow-sm hover:shadow-md border border-gray-200'} transition-all">â† å‰ã¸</button>
                    <span class="text-sm text-gray-500 font-bold">${currentPage} / ${tp}</span>
                    <button onclick="changePage(1)" ${currentPage>=tp?'disabled':''} class="px-5 py-2.5 rounded-lg font-bold text-sm ${currentPage>=tp?'bg-gray-100 text-gray-400 cursor-not-allowed':'bg-white text-gray-700 shadow-sm hover:shadow-md border border-gray-200'} transition-all">æ¬¡ã¸ â†’</button>
                </div>`;
            }
        }
        function changePage(d){const tp=Math.ceil(currentFilteredJobs.length/ITEMS_PER_PAGE);currentPage=Math.max(1,Math.min(tp,currentPage+d));renderPage();window.scrollTo({top:0,behavior:'smooth'});}
    </script>
</body>
</html>
